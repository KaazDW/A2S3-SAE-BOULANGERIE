{% extends 'base.html.twig' %}

{% block title %}Liste des Factures{% endblock %}

{% block body %}
    <section class="factures">
        <div class="container">
            <h1>Liste des Factures</h1>

            <div class="listeFactures" hx-target="this" hx-swap="outerHTML">
                {% include 'facture/factureParDate.html.twig' %}
            </div>
            <h2>Récapitulatif des Produits Commandés</h2>
            <ul>
                {% for produitNom, totalProduit in produitTotals %}
                    <li>
                        {{ produitNom }} - Quantité totale: {{ totalProduit }}
                        <ul>
                            {% for produit in produits %}
                                {% if produit.nom == produitNom %}
                                    {% for ingredientProduit in produit.ingredients %}
                                        {% set quantiteProduit = totalProduit %}
                                        {% set quantiteUtilisee = ingredientProduit.quantite * quantiteProduit %}
{#                                        {% set stockRestant = ingredientProduit.ingredient.stock - quantiteUtilisee %}#}
                                        <li>{{ ingredientProduit.ingredient.nom }} - Quantité: {{ ingredientProduit.quantite * quantiteProduit }}</li>
                                    {% endfor %}
                                {% endif %}
                            {% endfor %}
                            <p>DELIMITATION DES PRODUITS  </p>
                        </ul>
                    </li>
                {% endfor %}
            </ul>

            <h2>Quantités Totales des Ingrédients</h2>
            <ul>
                {% for ingredientNom, quantiteTotale in quantitesTotalesIngredients %}
                    <li>
                        {{ ingredientNom }} - Quantité totale: {{ quantiteTotale }} - Stock actuel:
                        {% for ingredient in ingredients %}
                            {% if ingredient.nom == ingredientNom %}
                                {% if ingredient.nom != "Eau"%}
                                    {% if ingredient.stock - quantiteTotale <=0 %}
                                        <span style="color: red;">{{ ingredient.stock - quantiteTotale}}</span>
                                        {% else %}
                                        {{ ingredient.stock - quantiteTotale}}
                                    {% endif %}
                                {% else %}
                                    EAU ILLIMITE
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    </li>
                {% endfor %}
            </ul>
        </div>
    </section>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

{% endblock %}