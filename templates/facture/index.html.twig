{% extends 'base.html.twig' %}

{% block title %}Liste des Factures{% endblock %}

{% block body %}
    <div class="container">
        <h1>Liste des Factures</h1>

        {# Afficher le formulaire #}
        {{ form_start(form) }}
        <button type="button" class="btn btn-primary" onclick="validerFormulaire()">Valider</button>
        {{ form_end(form) }}

        <div class="listeFactures" hx-target="this" hx-swap="outerHTML">
             {% include 'facture/factureParDate.html.twig' %}
        </div>

    </div>
{% endblock %}

{% block javascripts %}
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

        <script>
            var selectedFactures = [];

            // Fonction pour mettre à jour l'affichage des sélections
            function updateSelectionDisplay() {
            var displayContent = '';

            if (selectedFactures.length === 0) {
            displayContent = 'Aucune facture sélectionnée.';
        } else {
            selectedFactures.forEach(function(facture) {
            displayContent += "Facture ID: " + facture.id +
            ", Quantité: " + facture.quantite +
            ", Produit: " + facture.nomProduit + "<br>";
        });
        }

            $('#factures-selectionnees').html(displayContent);
        }
            /// Ajouter un gestionnaire d'événements aux checkboxes
            //$('.facture-checkbox').change(function() {
            //    handleFactureSelection(this);
            //});
            // Ajouter un gestionnaire d'événements au bouton de validation
            $('#submit-form-btn').click(function() {
                // Ajoutez votre logique ici pour traiter les factures sélectionnées
                console.log("Factures sélectionnées : ", selectedFactures);

            });
// Fonction pour gérer la sélection des factures
            function handleFactureSelection(checkbox) {
            console.log(checkbox);
            var factureId = $(checkbox).data('facture-id');
            var quantite = $(checkbox).data('quantite');
            var nomProduit = $(checkbox).data('nom-produit');
            if ($(checkbox).prop('checked')) {
            selectedFactures.push({
            id: factureId,
            quantite: quantite,
            nomProduit: nomProduit
        });
        } else {
            selectedFactures = selectedFactures.filter(function(facture) {
            return facture.id !== factureId;
        });
        }

            // Mettre à jour l'affichage des sélections
            updateSelectionDisplay();
        }
    </script>
    <script>
        function validerFormulaire() {
            // RECUPERE LA VALEUR DE LA DATE
            var dateValue = document.getElementById('{{ form.dateReservation.vars.id }}').value;

            // Effectue une requête AJAX
            fetch('/factures/' + dateValue, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                },
            })
                .then(response => response.text())
                .then(data => {
                    // Mets à jour le contenu de la div listeFactures avec la réponse
                    document.querySelector('.listeFactures').innerHTML = data;
                })
                .catch(error => console.error('Erreur lors de la requête:', error));
        }
    </script>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

{% endblock %}