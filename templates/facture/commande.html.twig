{# templates/facture/nouvelle_facture.html.twig #}

{% extends 'base.html.twig' %}

{% block title %}Nouvelle Facture{% endblock %}

{% block body %}
<div class="container">
    <form action="/ajouterFacture" method="post">
        <label for="dateReservation">Date de réservation</label>
        <input type="date" id="dateReservation" name="dateReservation" required>

        <br>

        <label for="nom">Nom</label>
        <input type="text" id="nom" name="nom" required>

        <label for="prenom">Prénom</label>
        <input type="text" id="prenom" name="prenom" required>

        <label for="produitDropdown">Sélectionnez un produit :</label>
        <select id="produitDropdown" name="produitDropdown">
            <option value="" disabled selected>Choisissez un produit</option>

            {% for produit in produits %}
                {# Assurez-vous d'avoir une méthode appropriée dans votre entité Produit pour obtenir le nom et l'ID #}
                <option value="{{ produit.id }}">{{ produit.nom }} {{produit.prixUnitaire}}€</option>
            {% endfor %}
        </select>

        <div id="produitsSelectionnes"></div>
        <div id="total">Total: €</div>

        <button type="submit">Valider</button>
    </form>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var produitDropdown = document.getElementById("produitDropdown");
            var produitsSelectionnes = document.getElementById("produitsSelectionnes");

            // Quand un produit du dropdown est sélectionné
            produitDropdown.addEventListener("change", function () {
                var selectedOption = produitDropdown.options[produitDropdown.selectedIndex];

                if (selectedOption.value !== "") {
                    // Crée une div pour le produit sélectionné
                    var produitDiv = document.createElement("div");
                    produitDiv.innerHTML = selectedOption.text;

                    // Attribue l'ID du produit comme ID de la div
                    produitDiv.id = "produitDiv_" + selectedOption.value;

                    // Ajoute le produit à la div des produits sélectionnés
                    produitsSelectionnes.appendChild(produitDiv);

                    // Ajoute un dropdown pour la quantité avec l'ID du produit
                    var quantiteDropdown = document.createElement("select");
                    quantiteDropdown.name = "quantiteProduit[" + selectedOption.value + "]";
                    for (var i = 1; i <= 20; i++) {
                        var option = document.createElement("option");
                        option.value = i;
                        option.text = i;
                        quantiteDropdown.appendChild(option);
                    }

                    // Ajoute le dropdown de quantité à la div des produits sélectionnés
                    produitDiv.appendChild(quantiteDropdown);

                    // Retire le produit du dropdown
                    selectedOption.remove();

                    // Réinitialise le dropdown pour sélectionner l'option vide
                    produitDropdown.selectedIndex = 0;
                }
            });
        });
    </script>
</div>
{% endblock %}
